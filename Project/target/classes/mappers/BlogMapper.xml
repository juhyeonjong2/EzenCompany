<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
			"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ezen.ezencompany.mapper.blogMapper">

<insert id="postBlog" parameterType="blogVo">
	INSERT INTO blog( mno, fno, bgtitle, bgcontent, bgrealcontent, blockyn, bghit, bgdate)	 
	VALUES ( #{mno}, #{fno}, #{bgtitle}, #{bgcontent}, #{bgrealcontent}, #{blockyn}, 0, now());
</insert>
	
<select id="selectLast" parameterType="int" resultType="blogVo">
	SELECT * FROM blog WHERE mno = #{mno} ORDER BY bgno DESC LIMIT 1;
</select>

<select id="selectRetireEmployees" resultType="blogUserVO">
	SELECT * FROM MEMBER WHERE nullif(mid, '') IS NOT NULL AND enabled=0;
</select>

<select id="selectOptionEmployees" parameterType="employeeOptionVO" resultType="blogUserVO">
	SELECT * FROM member as M 
	LEFT JOIN employeeoption as E ON m.mno = e.mno 
	WHERE E.cidx = #{cidx} AND E.aidx = #{aidx} AND M.enabled = 1;
</select>

<select id="selectCategorys" resultType="categoryVO">
	SELECT * FROM category;
</select>

<select id="selectAttributes" resultType="attributeVO">
	SELECT * FROM attribute;
</select>

<select id="selectAdditionalOptions" parameterType="int"  resultType="employeeOptionVO">
	SELECT * FROM employeeoption WHERE mno=#{value};
</select>

<insert id="insertFolder" parameterType="folderVO" useGeneratedKeys="true" keyProperty="fno">
	INSERT INTO folder(pfno, fname, mno) VALUES(#{pfno}, #{fname}, #{mno});
</insert>

<select id="selectFolders" parameterType="int"  resultType="folderVO">
	SELECT * FROM folder WHERE mno=#{value};
</select>

<select id="selectBlogList" parameterType="int" resultType="blogVo">
	SELECT * FROM blog WHERE mno = #{mno} AND blockyn='n';
</select>

<select id="selectBlogListAll" parameterType="int" resultType="blogVo">
	SELECT * FROM blog WHERE mno = #{mno};
</select>

<select id="selectOneForce" parameterType="int" resultType="blogVo">
	SELECT * FROM blog WHERE bgno = #{bgno};
</select>

<select id="selectOne" parameterType="int" resultType="blogVo">
	SELECT * FROM blog WHERE bgno = #{bgno} AND blockyn='n';
</select>

<select id="selectReply" parameterType="int" resultType="blogReplyVO" >
	SELECT * FROM blogreply WHERE bgrno = #{bgrno};
</select>

<select id="selectReplyList" parameterType="int" resultType="blogReplyVO">
	SELECT * FROM blogreply WHERE bgno = #{bgno};
</select>

<insert id="insertReply" parameterType="blogReplyVO" useGeneratedKeys="true" keyProperty="bgrno">
	INSERT INTO blogreply(bgrpno, bgrcontent, bgrdate, bgno, mno, delyn) VALUES(#{bgrpno},#{bgrcontent}, now(), #{bgno}, #{mno}, 'n');
</insert>

<update id="removeReply" parameterType="int">
	UPDATE blogreply SET delyn = 'y' WHERE bgrno = #{bgrno};
</update>

<update id="modifyReply" parameterType="blogReplyVO">
	UPDATE blogreply 
	SET bgrcontent = #{bgrcontent} 
	WHERE bgrno = #{bgrno};
</update>

</mapper>